// 
// Global Mixins and Functions
// ===========================

// TODO: use Sass 3.3 maps
@mixin add-theme(
    $module,
    $theme: 'default'
) {
    $themes: append($themes, ($module, $theme));
}

@mixin theme($color) {
    @include foreground-color($color);

    background-color: $color;
}

// TODO: add support for rgba() values! (alpha channel)
@function delta-color(
    $color,
    $delta: 10%
) {
    @if is-dark($color) {
        @return darken($color, $delta);
    } @else {
        @return lighten($color, $delta);
    }
}

@function foreground-color(
    $color,
    $delta: 0%,
    $threshold: 65%,
    $color-light: $color-light,
    $color-dark: $color-dark
) {
    @if type-of($color) == color {
        @if lightness($color) > $threshold {
            @return delta-color($color-dark);

        } @else if lightness($color) <= $threshold {
            @return delta-color($color-light);
        }
    } @else {
        @return inherit;
    }
}

@mixin foreground-color(
    $color, 
    $darken: 35%, 
    $threshold: 65%, 
    $color-light: $type-base-color-light, 
    $color-dark: $type-base-color-dark,
    $color-default: inherit,
    $component: 'all'
) {
    $_color: $color-default !default;

    @if type-of($color) == color {
        @if lightness($color) > $threshold {
            @if ($component == 'type' or $component == 'all') {
                &, p, li, span { color: $color-dark; }
            }
            @if ($component == 'heading' or $component == 'all') {
                %heading { color: $type-heading-color-dark; }
            }
            @if ($component == 'anchor' or $component == 'all') {
                %anchor { @extend %anchor-dark; }
            }
        } @else {
            @if ($component == 'type' or $component == 'all') {
                &, p, li, span { color: $color-light; }
            }
            @if ($component == 'heading' or $component == 'all') {
                %heading { color: $type-heading-color-light; }
            }
            @if ($component == 'anchor' or $component == 'all') {
                %anchor { @extend %anchor-light; }
            }
        }
    } @else if $color == static or $color == transparent {
        $_color: false;
    } @else {
        $_color: $color-default;
    }
}

// Transition Mixin
@mixin transition(
    $property: all,
    $transition-duration: $transition-duration,
    $transition-timing-function: $transition-timing-function
) {
    @include transition-property($property);
    @include transition-duration($transition-duration);
    @include transition-timing-function($transition-timing-function);
}

@mixin translate(
    $horizontal: false,
    $vertical: false
) {
    @if $vertical and $horizontal {
        @include experimental(transform, translateX($horizontal) translateY($vertical));
    } @else {    
        @if $vertical {
            @include experimental(transform, translateY($vertical));
        }

        @if $horizontal {
            @include experimental(transform, translateX($horizontal));
        }
    }
}

@mixin position-absolute(
    $vertical: false,
    $horizontal: false,
    $top: false,
    $bottom: false,
    $left: false,
    $right: false
) {
    $transform-list: null;

    position: absolute;

    @if $vertical {    
        @if $vertical == top {
            top: 0;
            bottom: inherit;
            // @include experimental(transform, none);
        }
        @else if $vertical == bottom {
            bottom: 0;
            top: inherit;
            // @include experimental(transform, none);
        }
        @else if $vertical == below {
            top: 100%;
            bottom: inherit;
            // @include experimental(transform, none);
        }
        @else if $vertical == above {
            bottom: 100%;
            top: inherit;
            // @include experimental(transform, none);
        }
        @else if $vertical == center {
            top: 50%;
            $transform-list: append($transform-list, translateY(-50%));
            bottom: inherit;
        }
        @else {
            top: $vertical;
            bottom: inherit;
            // @include experimental(transform, none);
        }
    }

    @if $horizontal {
        @if $horizontal == left { 
            left: 0;
            right: inherit;
            // @include experimental(transform, none);
        }
        @else if $horizontal == right {
            right: 0;
            left: inherit;
            // @include experimental(transform, none);
        }
        @else if $horizontal == center {
            left: 50%;
            $transform-list: append($transform-list, translateX(-50%));
        }
        @else {
            left: $horizontal;
            // @include experimental(transform, none);
        }
    }

    @if $top {
        top: $top;
        bottom: inherit;
        // @include experimental(transform, none);
    }

    @if $bottom {
        bottom: $bottom;
        top: inherit;
        // @include experimental(transform, none);
    }

    @if $left {
        left: $left;
        right: inherit;
        // @include experimental(transform, none);
    }

    @if $right {
        right: $right;
        left: inherit;
        // @include experimental(transform, none);
    }

    @if $transform-list {
        @include experimental(transform, $transform-list);
    }
}

@mixin valign($position, $selector: false) {
    display: table;

    $_selector: '> * ';

    @if $selector {
        $_selector: $selector;
    }

    #{$_selector} {
        display: table-cell;
        vertical-align: $position;
    }
}

@mixin valign-all($position, $selector: false) {
    > * {
        @include valign($position, $selector);
    }
}

@function column-width(
    $columns,
    $gutter: false
) {
    // if $columns is an int, calculate from $grid-columns
    @if round($columns) == $columns and unit($columns) == '' {

        @if $gutter {
            @return calc(#{$columns} * ((100% - #{$gutter * ($grid-columns - 1)}) / #{$grid-columns}) + (#{($columns - 1) * $gutter}));
        } @else {
            @return percentage($columns / $grid-columns);
        }
    } @else if index(('%', 'px', 'em', 'rem'), unit($columns)) {
        @return $columns;
    } @else {
        @return percentage($columns);
    }
}

@function column-offset-width(
    $columns,
    $gutter: false
) {
    // if $columns is an int, calculate from $grid-columns
    @if round($columns) == $columns and unit($columns) == '' {

        @if $gutter {
            @return calc(#{$columns} * ((100% - #{$gutter * ($grid-columns - 1)}) / #{$grid-columns}) + (#{$columns * $gutter}));
        } @else {
            @return column-width($columns);
        }
    } @else {
        @return column-width($columns);
    }
}

@function row-height($rows) {
    // This is (currently) the same result as column-width
    @return column-width($rows);
}

